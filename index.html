<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>MindBloow — AI Interactive</title>
  <meta name="description" content="MindBloow — Edukasi, Tes, dan Konsultasi AI untuk kesehatan mental .">

  <style>
  :root{
    --bg: #FBFDFF;
    --card: #ffffff;
    --muted: #62718a;
    --primary: #4f73ff;
    --accent: #ff9ebd;
    --radius: 14px;
    --gap: 16px;
    --shadow: 0 10px 30px rgba(12,34,56,0.06);
    font-family: 'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
  }

  *{box-sizing:border-box}
  html,body{
    height:100%;
    margin:0;
    background:linear-gradient(180deg,#FBFDFF,#F7FAFF 60%);
    color:#0f172a;
  }

  /* ==========================================
     HEADER FIXED FINAL — 100% WORKING
     ========================================== */
  header{
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 9999;

    background:#ffffffee;
    backdrop-filter:blur(8px);
    border-bottom:1px solid #dce2ee;
    box-shadow:0 4px 14px rgba(0,0,0,0.08);
    padding:14px 20px;
  }

  /* agar seluruh konten turun */
  body{
    padding-top: 90px;
  }

  .nav-inner{
    max-width:1100px;
    margin:0 auto;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }

  .brand{
    display:flex;
    align-items:center;
    gap:10px;
  }

  .brand .logo{
    font-weight:700;
    color:var(--primary);
    font-size:20px;
  }

  .menu{
    display:flex;
    gap:8px;
  }

  .menu button{
    background:transparent;
    border:0;
    padding:8px 12px;
    border-radius:10px;
    font-weight:600;
    color:var(--muted);
    cursor:pointer;
  }

  .menu button[aria-current="true"]{
    background:linear-gradient(90deg,var(--primary),var(--accent));
    color:white;
    box-shadow:var(--shadow);
  }

  .nav-toggle{
    display:none;
    background:transparent;
    border:0;
    padding:8px;
    border-radius:10px;
  }

  .site{display:flex;flex-direction:column;min-height:100vh}
  main{flex:1;max-width:1100px;margin:20px auto;padding:20px;width:100%}
  .page{display:none}
  .page.active{display:block}

  /* Cards */
  .grid{display:grid;gap:18px}
  .grid.cols-3{grid-template-columns:repeat(3,1fr)}
  .card{background:var(--card);padding:18px;border-radius:var(--radius);box-shadow:var(--shadow)}

  /* Hero */
  .hero{
    display:flex;
    align-items:center;
    gap:24px;
    padding:28px;
    border-radius:14px;
    background:linear-gradient(135deg,#eaf4ff,#fff0f6);
  }
  .hero h1{margin:0;font-size:28px}
  .hero p{margin:6px 0;color:var(--muted)}

  /* Edu Illustration */
  .illustration{
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
    border-radius:12px;
    background:linear-gradient(180deg,#fff,#F6FAFF);
    box-shadow:0 6px 20px rgba(79,115,255,0.06);
  }

  .illus-svg{
    width:100%;
    height:auto;
    max-width:420px;
  }

  /* Quiz */
  .quiz-card{display:flex;flex-direction:column;gap:12px}
  .progress{
    height:12px;background:#eef6ff;
    border-radius:999px;overflow:hidden;
  }
  .progress > i{
    display:block;height:100%;
    width:0;
    background:linear-gradient(90deg,#6fb3ff,#ff9ebd);
    transition:width 300ms ease;
  }
  .question{
    background:rgba(255,255,255,0.95);
    padding:14px;border-radius:10px;
  }
  .choices{display:flex;gap:8px;flex-wrap:wrap}
  .choice{
    flex:1;padding:10px;border-radius:10px;
    border:1px solid #e6eef8;text-align:center;
    cursor:pointer;background:white;
  }
  .choice.selected{
    background:linear-gradient(90deg,var(--primary),var(--accent));
    color:#fff;border-color:transparent;
  }

  .result{
    padding:12px;border-radius:10px;
    background:#fff9f9;border:1px solid #ffe6ed;
  }

  /* Chat AI */
  .chat{display:flex;flex-direction:column;gap:10px}
  .history{
    min-height:120px;
    max-height:420px;
    overflow:auto;
    padding:10px;
    border-radius:10px;
    background:linear-gradient(180deg,#fff,#fbfbff)
  }
  .bubble{
    padding:10px;border-radius:12px;margin-bottom:8px;max-width:78%
  }
  .bubble.user{background:#e8f4ff;margin-left:auto}
  .bubble.bot{background:#fff0f6}
  .quick-replies{display:flex;gap:8px;flex-wrap:wrap}
  .chip{
    padding:8px 10px;border-radius:999px;
    border:1px solid #e6eef8;background:white;
    cursor:pointer
  }

  /* Disorders */
  .disorders{display:flex;flex-direction:column;gap:12px;margin-top:12px}
  .disorder{
    border:1px solid #eef6ff;padding:12px;
    border-radius:12px;background:linear-gradient(180deg,#fff,#fcfcff)
  }
  .disorder h3{margin:0 0 6px 0}
  .disorder .meta{color:var(--muted);font-size:14px;margin-bottom:8px}
  .disorder .more{display:none;margin-top:8px}
  .disorder.open .more{display:block}
  .disorder .toggle{
    background:transparent;border:0;color:var(--primary);
    font-weight:700;cursor:pointer
  }

  footer{
    padding:20px;text-align:center;color:var(--muted)
  }

  /* Responsive */
  @media (max-width:900px){
    .menu{
      display:none;flex-direction:column;
      gap:14px;position:absolute;top:70px;right:20px;
      background:white;padding:18px;border-radius:12px;
      box-shadow:0 8px 30px rgba(0,0,0,0.1);
      min-width:180px;
    }
    .nav-toggle{display:inline-flex}
    .hero{flex-direction:column;text-align:left}
  }

  @media (max-width:600px){
    .hero{padding:20px}
    .hero h1{font-size:22px;line-height:1.3}
    .illustration{padding:12px}
    main{padding:10px}
    .card{padding:14px}
  }
  </style>
</head>

<body>
  <div class="site">

    <!-- HEADER FINAL -->
    <header>
      <div class="nav-inner">
        <div class="brand">
          <div class="logo">MindBloow</div>
        </div>

        <nav>
          <div class="menu" role="tablist" aria-label="Main navigation">
            <button data-page="home" aria-current="true">Beranda</button>
            <button data-page="edu">Edukasi</button>
            <button data-page="signs">Tanda-tanda</button>
            <button data-page="help">Cara Mengatasi</button>
            <button data-page="test">Tes Mental</button>
            <button data-page="consult">Konsultasi</button>
          </div>
          <button class="nav-toggle" aria-label="Buka menu">☰</button>
        </nav>
      </div>
    </header>

    <main>

      <!-- HOME -->
      <section id="home" class="page active">
        <div class="hero card">
          <div>
            <h1>Jaga Kesehatan Mentalmu</h1>
            <p>Self-screening, edukasi, dan dukungan awal berbasis pola — demo AI ringan.</p>
            <div style="margin-top:12px">
              <button data-page="test" class="chip">Mulai Tes</button>
              <button data-page="consult" class="chip">Konsultasi Sekarang</button>
            </div>
          </div>
          <div class="illustration" aria-hidden="true">

            <!-- SVG -->
            <svg class="illus-svg" viewBox="0 0 560 360" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="g1" x1="0" x2="1">
                  <stop offset="0" stop-color="#E8F4FF"/>
                  <stop offset="1" stop-color="#FFF0F6"/>
                </linearGradient>
              </defs>
              <rect x="0" y="0" width="560" height="360" rx="18" fill="url(#g1)" />
              <g transform="translate(40,40)">
                <ellipse cx="220" cy="140" rx="90" ry="85" fill="#FFF" opacity="0.9" />
                <circle cx="120" cy="120" r="36" fill="#FFDEE9" opacity="0.9" />
                <circle cx="300" cy="80" r="28" fill="#DFF7FF" opacity="0.95" />
                <path d="M70 220c35-30 210-30 250 0 v20H70z" fill="#fff" opacity="0.6" />
              </g>
            </svg>

          </div>
        </div>
      </section>

      <!-- EDUKASI -->
      <section id="edu" class="page">
        <div class="card">
          <h2>Edukasi Lengkap: Kondisi Kesehatan Mental Umum</h2>
          <p class="muted">Di bawah ini adalah ringkasan singkat tiap kondisi...</p>

          <div style="display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap;margin-top:16px">
            <div style="flex:1;min-width:320px">

              <div class="grid cols-3">
                <div class="card"><h3>Depresi</h3><p>Gangguan suasana hati...</p></div>
                <div class="card"><h3>Kecemasan</h3><p>Khawatir berlebih...</p></div>
                <div class="card"><h3>Burnout</h3><p>Kelelahan kronis...</p></div>
              </div>

              <!-- FULL disorders list -->
              <div class="disorders" id="disordersList">

                <!-- Depresi -->
                <article class="disorder" data-key="depresi">
                  <h3>1. Depresi (Gangguan Depresif Mayor)</h3>
                  <div class="meta">Definisi...</div>
                  <div><strong>Gejala umum:</strong>
                    <ul>
                      <li>Perasaan sedih</li>
                      <li>Kehilangan minat</li>
                      <li>Gangguan tidur</li>
                    </ul>
                  </div>
                  <div class="more">
                    <strong>Kapan mencari bantuan:</strong>
                    <p>Jika gejala berlangsung...</p>
                    <strong>Saran awal:</strong>
                    <ul>
                      <li>Dukungan sosial</li>
                      <li>Terapi CBT</li>
                    </ul>
                    <button class="toggle">Tutup</button>
                  </div>
                </article>

                <!-- Kecemasan -->
                <article class="disorder" data-key="kecemasan">
                  <h3>2. Kecemasan (GAD)</h3>
                  <div class="meta">Definisi...</div>
                  <div><strong>Gejala umum:</strong></div>
                  <div class="more">
                    <p>Jika mengganggu aktivitas...</p>
                    <button class="toggle">Tutup</button>
                  </div>
                </article>

                <!-- Burnout -->
                <article class="disorder" data-key="burnout">
                  <h3>3. Burnout</h3>
                  <div class="meta">Definisi...</div>
                  <div class="more">
                    <p>Kelelahan ekstrem...</p>
                    <button class="toggle">Tutup</button>
                  </div>
                </article>

                <!-- Bipolar -->
                <article class="disorder" data-key="bipolar">
                  <h3>4. Gangguan Bipolar</h3>
                  <div class="meta">Definisi...</div>
                  <div class="more">
                    <p>Perubahan mood ekstrem...</p>
                    <button class="toggle">Tutup</button>
                  </div>
                </article>

                <!-- Skizofrenia -->
                <article class="disorder" data-key="skizofrenia">
                  <h3>5. Skizofrenia</h3>
                  <div class="meta">Definisi...</div>
                  <div class="more">
                    <button class="toggle">Tutup</button>
                  </div>
                </article>

                <!-- PTSD -->
                <article class="disorder" data-key="ptsd">
                  <h3>6. PTSD</h3>
                  <div class="meta">Definisi...</div>
                  <div class="more">
                    <button class="toggle">Tutup</button>
                  </div>
                </article>

                <!-- OCD -->
                <article class="disorder" data-key="ocd">
                  <h3>7. OCD</h3>
                  <div class="meta">Definisi...</div>
                  <div class="more">
                    <button class="toggle">Tutup</button>
                  </div>
                </article>

              </div>
            </div>

            <div style="width:320px">
              <div class="illustration card">
                <svg viewBox="0 0 360 360" class="illus-svg">
                  <defs>
                    <linearGradient id="eduGrad" x1="0" x2="1">
                      <stop offset="0" stop-color="#FFF1F6"/>
                      <stop offset="1" stop-color="#F0FBFF"/>
                    </linearGradient>
                  </defs>
                  <rect width="100%" height="100%" rx="12" fill="url(#eduGrad)"/>
                  <g transform="translate(20,20)">
                    <circle cx="90" cy="90" r="62" fill="#FFEAF2" />
                  </g>
                </svg>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- SIGNS -->
      <section id="signs" class="page">
        <div class="card">
          <h2>Tanda-tanda yang Perlu Diperhatikan</h2>
          <p class="muted">Berikut adalah tanda-tanda umum...</p>

          <ol>
            <li><strong>Kehilangan energi</strong><br>Kelelahan...</li>
            <li><strong>Menarik diri</strong><br>Menghindari sosial...</li>
            <li><strong>Mood berubah</strong></li>
            <li><strong>Gangguan tidur</strong></li>
            <li><strong>Khawatir berlebihan</strong></li>
            <li><strong>Perubahan makan</strong></li>
            <li><strong>Sakit fisik</strong></li>
            <li><strong>Kesulitan fokus</strong></li>
            <li><strong>Putus asa</strong></li>
            <li><strong>Ketergantungan zat</strong></li>
          </ol>
        </div>
      </section>

      <!-- HELP -->
      <section id="help" class="page">
        <div class="card">
          <h2>Cara Mengatasi</h2>
          <p class="muted">Berikut strategi...</p>

          <ol>
            <li><strong>Curhat</strong><br>Berbagi perasaan...</li>
            <li><strong>Istirahat</strong></li>
            <li><strong>Journaling</strong></li>
            <li><strong>Bantuan profesional</strong></li>
            <li><strong>Pola makan sehat</strong></li>
            <li><strong>Boundary</strong></li>
            <li><strong>Hobi</strong></li>
            <li><strong>Aktivitas fisik</strong></li>
            <li><strong>Relaksasi</strong></li>
            <li><strong>Sinar matahari</strong></li>
          </ol>
        </div>
      </section>

      <!-- TEST -->
      <section id="test" class="page">
        <div class="card quiz-card">
          <h2>Tes Interaktif (GAD-like Singkat)</h2>
          <p class="muted">Jawablah setiap pertanyaan...</p>

          <div class="progress"><i id="progressFill"></i></div>
          <div id="qArea"></div>

          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
            <button id="prevQ" class="chip" style="display:none">Kembali</button>
            <button id="nextQ" class="chip">Lanjut</button>
          </div>

          <div id="resultBox" class="result" style="display:none;margin-top:12px"></div>
        </div>
      </section>

      <!-- CONSULT -->
      <section id="consult" class="page">
        <div class="card chat">
          <h2>Konsultasi — AI Support (demo)</h2>
          <div id="history" class="history"></div>

          <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
            <input id="story" placeholder="Ceritakan apa yang kamu rasakan..." style="flex:1;padding:12px;border-radius:10px;border:1px solid #e6eef8" />
            <button id="sendBtn" class="chip">Kirim</button>
            <button id="clearBtn" class="chip">Bersihkan</button>
          </div>

          <div style="margin-top:8px" class="quick-replies">
            <button class="chip quick" data-q="cemas">Saya cemas</button>
            <button class="chip quick" data-q="sedih">Saya sedih</button>
            <button class="chip quick" data-q="tidur">Sulit tidur</button>
            <button class="chip quick" data-q="sendiri">Saya merasa sendiri</button>
          </div>
        </div>
      </section>

    </main>

    <footer>
      <small>© 2025 MindBloow — Demo. Bukan pengganti profesional.</small>
    </footer>
  </div>

  <!-- ==========================================================
       SCRIPT SPA + QUIZ + CHAT AI — FULL TANPA POTONGAN
       ========================================================== -->
  <script>

  /* SPA */
  (function(){
    const buttons = document.querySelectorAll('[data-page]');
    const pages = document.querySelectorAll('.page');

    function show(id){
      pages.forEach(p=>p.classList.toggle('active', p.id===id));
      buttons.forEach(b=>b.setAttribute('aria-current', b.dataset.page===id?'true':'false'));
      history.replaceState(null,'','#'+id);
    }

    buttons.forEach(b=>b.addEventListener('click',()=>show(b.dataset.page)));

    const init = location.hash ? location.hash.substring(1) : 'home';
    show(init);

    const navToggle = document.querySelector('.nav-toggle');
    const menu = document.querySelector('.menu');

    navToggle.addEventListener('click',()=>{
      menu.style.display = menu.style.display==='flex' ? 'none' : 'flex';
    });

    document.addEventListener('click',(e)=>{
      if(!menu.contains(e.target) && !navToggle.contains(e.target) && window.innerWidth < 900){
        menu.style.display='none';
      }
    });
  })();

  /* QUIZ */
  (function(){
    const questions=[
      'Merasa gugup, gelisah, atau tegang?',
      'Tidak dapat menghentikan kekhawatiran?',
      'Khawatir berlebihan?',
      'Sulit santai?',
      'Sulit berhenti merasa khawatir?',
      'Sulit tidur karena kecemasan?',
      'Kehilangan minat karena cemas?'
    ];

    const qArea=document.getElementById('qArea');
    const prev=document.getElementById('prevQ');
    const next=document.getElementById('nextQ');
    const progress=document.getElementById('progressFill');
    const resultBox=document.getElementById('resultBox');

    let idx=0;
    let answers=new Array(questions.length).fill(null);

    function render(i){
      qArea.innerHTML='';
      const q=document.createElement('div'); q.className='question';
      const h=document.createElement('h3'); h.innerText=(i+1)+'. '+questions[i];
      q.appendChild(h);

      const choices=document.createElement('div'); choices.className='choices';
      const labels=['Tidak sama sekali','Beberapa hari','> Setengah hari','Hampir setiap hari'];

      for(let j=0;j<4;j++){
        const btn=document.createElement('button');
        btn.className='choice';
        btn.innerText=labels[j];
        btn.dataset.val=j;
        if(answers[i]===j) btn.classList.add('selected');
        btn.addEventListener('click',()=>{
          answers[i]=j;
          updateSelected(i);
        });
        choices.appendChild(btn);
      }

      q.appendChild(choices);
      qArea.appendChild(q);

      const pct=Math.round((i/(questions.length-1))*100);
      progress.style.width=pct+'%';

      prev.style.display=i===0?'none':'inline-flex';
      next.innerText=i<questions.length-1?'Lanjut':'Selesai';
      resultBox.style.display='none';
    }

    function updateSelected(i){
      qArea.querySelectorAll('.choice').forEach(n=>{
        n.classList.toggle('selected', Number(n.dataset.val)===answers[i]);
      });
    }

    prev.addEventListener('click',()=>{
      if(idx>0){idx--; render(idx);}
    });

    next.addEventListener('click',()=>{
      if(answers[idx]===null){alert('Pilih jawaban dulu.');return;}
      if(idx<questions.length-1){idx++;render(idx);}
      else {showResult();}
    });

    function showResult(){
      const sum=answers.reduce((s,v)=>s+(v??0),0);
      const max=questions.length*3;
      let category='', label='';

      if(sum>=max*0.7){category='Tinggi';label='Tinggi — Perlu perhatian profesional';}
      else if(sum>=max*0.4){category='Sedang';label='Sedang — Perlu pemantauan';}
      else {category='Ringan';label='Ringan — Perawatan diri cukup';}

      const suggestions={
        'Ringan':['Coba teknik napas 5 menit.','Rutinitas tidur konsisten.','Ceritakan ke teman.'],
        'Sedang':['Coba journaling.','Kurangi paparan berita negatif.','Pertimbangkan konseling.'],
        'Tinggi':['Cari bantuan profesional.','Jika ada pikiran berbahaya, hubungi layanan darurat.','Jangan memendam sendiri.']
      };

      resultBox.style.display='block';
      resultBox.innerHTML=`
        <h3>Hasil Tes</h3>
        <p class="muted">Skor: <strong>${sum}</strong> / ${max} — <strong>${label}</strong></p>
        <div>
          <strong>Saran awal:</strong>
          <ul>${suggestions[category].map(s=>`<li>${s}</li>`).join('')}</ul>
        </div>
        <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end">
          <button id="retake" class="chip">Ulangi</button>
          <button id="talk" class="chip" data-goto="consult">Konsultasi</button>
        </div>
      `;

      document.getElementById('retake').addEventListener('click',()=>{
        answers=new Array(questions.length).fill(null);
        idx=0;
        render(0);
        progress.style.width='0%';
        resultBox.style.display='none';
      });

      document.getElementById('talk').addEventListener('click',()=>{
        document.querySelector('[data-page="consult"]').click();
      });

      progress.style.width='100%';
    }

    render(0);
  })();

  /* CONSULT AI */
  (function(){
    const history=document.getElementById('history');
    const story=document.getElementById('story');
    const sendBtn=document.getElementById('sendBtn');
    const clearBtn=document.getElementById('clearBtn');
    const quicks=document.querySelectorAll('.quick');

    function append(text,who='bot',opt={html:false}){
      const el=document.createElement('div');
      el.className='bubble '+(who==='user'?'user':'bot');
      el.innerHTML=opt.html?text:`<div>${escape(text)}</div>`;
      history.appendChild(el);
      history.scrollTop=history.scrollHeight;
    }

    function escape(s){
      return String(s)
      .replace(/&/g,'&amp;')
      .replace(/</g,'&lt;')
      .replace(/>/g,'&gt;');
    }

    function typing(ms=600){
      append('...','bot');
      return new Promise(res=>{
        setTimeout(()=>{
          const last=history.querySelector('.bubble.bot:last-child');
          if(last && last.textContent==='...') last.remove();
          res();
        },ms);
      });
    }

    function safetyCheck(t){
      const cues=['bunuh','mati','nggak mau hidup','mengakhiri hidup','kepengin mati'];
      t=t.toLowerCase();
      return cues.some(c=>t.includes(c));
    }

    function analyze(text){
      const t=text.toLowerCase();
      const out={responses:[],actions:[]};

      if(safetyCheck(t)){
        out.responses.push(
          'Aku mendengar sesuatu yang membuatku khawatir tentang keselamatanmu. Jika kamu berpikir untuk menyakiti diri sendiri, hubungi layanan darurat sekarang.'
        );
        out.responses.push(
          'Di Indonesia, hubungi **119 ext. 9** untuk layanan krisis jiwa, atau layanan kesehatan terdekat.'
        );
        out.actions=['Info Darurat','Cari Bantuan Sekarang'];
        return out;
      }

      const groups={
        anxiety:['cemas','takut','khawatir','gelisah','panik'],
        sadness:['sedih','down','menangis','kecewa','galau'],
        lonely:['sendiri','kesepian','tak ada teman'],
        sleep:['tidur','insomnia','susah tidur'],
        tired:['lelah','capek','burnout'],
        relationship:['pacar','hubungan','putus','bertengkar'],
        work:['kerja','kantor','deadline']
      };

      function match(keys){return keys.some(k=>t.includes(k));}

      if(match(groups.anxiety)){
        out.responses.push("Kamu terlihat sedang merasa cemas. Mau aku bantu dengan teknik napas 4-4-4?");
        out.actions.push("Panduan Pernapasan","Grounding 5-4-3-2-1");
      }
      if(match(groups.sadness)){
        out.responses.push("Aku ikut sedih mendengar itu. Perasaan itu valid.");
        out.actions.push("Curhat ke Teman","Menuliskan Perasaan");
      }
      if(match(groups.lonely)){
        out.responses.push("Rasa kesepian bisa sangat berat. Mau aku bantu idenya?");
        out.actions.push("Ide Kontak Sosial","Komunitas");
      }
      if(match(groups.sleep)){
        out.responses.push("Masalah tidur sering memengaruhi mood. Mau tips rutinitas tidur?");
        out.actions.push("Tips Tidur","Latihan Relaksasi");
      }
      if(match(groups.tired)){
        out.responses.push("Kamu terdengar lelah. Mungkin kamu butuh jeda sebentar.");
        out.actions.push("Atur Batasan Kerja","Cuti Singkat");
      }
      if(match(groups.relationship)){
        out.responses.push("Masalah hubungan bisa sangat menguras emosi.");
        out.actions.push("Contoh Kalimat Aman","Terapi Pasangan");
      }
      if(match(groups.work)){
        out.responses.push("Tekanan kerja memang berat.");
        out.actions.push("Susun Batasan Kerja","Teknik Pomodoro");
      }

      if(out.responses.length===0){
        out.responses.push("Terima kasih sudah berbagi. Cerita lebih detail boleh, kapan mulai merasa seperti ini?");
        out.actions.push("Ceritakan Detail","Lakukan Tes Singkat");
      }

      return out;
    }

    async function botReply(text){
      await typing(700);
      const a=analyze(text);

      for(const r of a.responses){
        await typing(350);
        append(r,'bot');
      }

      if(a.actions.length){
        const row=document.createElement('div');
        row.className='quick-replies';
        a.actions.forEach(act=>{
          const b=document.createElement('button');
          b.className='chip';
          b.innerText=act;
          b.addEventListener('click',()=>handleAction(act));
          row.appendChild(b);
        });

        const test=document.createElement('button');
        test.className='chip';
        test.innerText='Lakukan Tes';
        test.addEventListener('click',()=>document.querySelector('[data-page="test"]').click());
        row.appendChild(test);

        const emergency=document.createElement('button');
        emergency.className='chip';
        emergency.innerText='Info Darurat';
        emergency.addEventListener('click',()=>alert('Hubungi layanan darurat atau fasilitas kesehatan terdekat.'));
        row.appendChild(emergency);

        history.appendChild(row);
        history.scrollTop=history.scrollHeight;
      }
    }

    function handleAction(name){
      if(name==='Panduan Pernapasan'){
        append('<strong>Napas 4-4-4:</strong><br>Tarik 4 detik — tahan 4 detik — buang 4 detik.','bot',{html:true});
      }
      else if(name==='Grounding 5-4-3-2-1'){
        append('<strong>Grounding:</strong><br>Sebut 5 benda, 4 sentuhan, 3 suara, 2 bau, 1 rasa aman.','bot',{html:true});
      }
      else if(name==='Tips Tidur'){
        append('Matikan layar 30 menit sebelum tidur, minum air hangat, lakukan peregangan ringan.','bot');
      }
      else if(name==='Atur Batasan Kerja'){
        append('Contoh: “Aku tidak membalas chat kerja setelah jam 8 malam.”','bot');
      }
      else append(`Oke — ${name}.`, 'bot');
    }

    sendBtn.addEventListener('click',()=>{
      const t=story.value.trim();
      if(!t) return;
      append(t,'user');
      story.value='';
      botReply(t);
    });

    clearBtn.addEventListener('click',()=>{
      history.innerHTML='';
      story.value='';
      story.focus();
    });

    quicks.forEach(q=>{
      q.addEventListener('click',()=>{
        const t=q.dataset.q==='cemas'?'Saya cemas'
          :q.dataset.q==='sedih'?'Saya sedih'
          :q.dataset.q==='tidur'?'Saya susah tidur'
          :'Saya merasa sendiri';
        story.value=t;
        sendBtn.click();
      });
    });

    story.addEventListener('keydown',e=>{
      if(e.key==='Enter'&&!e.shiftKey){
        e.preventDefault();
        sendBtn.click();
      }
    });

  })();

  /* DISORDER TOGGLES */
  (function(){
    document.querySelectorAll('.disorder').forEach(d=>{
      const toggle=d.querySelector('.toggle');
      if(!toggle) return;
      toggle.addEventListener('click',()=>{
        const open=d.classList.toggle('open');
        toggle.innerText=open?'Tutup':'Buka detail';
        toggle.setAttribute('aria-expanded',String(open));
      });
      d.querySelector('h3').addEventListener('click',()=>{
        const open=d.classList.toggle('open');
        const t=d.querySelector('.toggle');
        if(t){
          t.innerText=open?'Tutup':'Buka detail';
          t.setAttribute('aria-expanded',String(open));
        }
      });
    });
  })();

  </script>

</body>
</html>
